<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link type="text/css" rel="stylesheet" href="https://www.gstatic.com/firebasejs/ui/6.0.0/firebase-ui-auth.css" />
    <link type="text/css" rel="stylesheet" href="styles/login_style.css" />

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous">
        </script>

    <!-- Firebase 8 CDNs-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-b5kHyXgcpbZJO/tY9Ul7kGkf1S0CWuKcCD38l8YkeH8z8QjE0GmW1gYU5S9FOnJ0" crossorigin="anonymous">
        </script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/ui/6.0.0/firebase-ui-auth.js"></script>

    <!-- Link to the api keys for your firebase project -->
    <script src="/scripts/firebaseAPI.js"></script>

    <style>
        input::-webkit-inner-spin-button,
        input::-webkit-outer-spin-button {
            display: none;
            margin: 0;
        }
    </style>
    <title>Communiti Sign up</title>
</head>

<body>
    <!-- Header Navigation Bar -->
    <nav class="navbar navbar-expand-lg navbar-light bg-info m-3">
        <div class="container-fluid d-flex justify-content-lg-evenly">
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <a class="navbar-brand" href="#">Communiti</a>

            <i class="material-icons">person_outline</i>

            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="index.html">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="login.html">Login/Signup</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="#">About us</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <section style="text-align:center;">
        <h1 class="largecentertext">Welcome to Communiti, <span id="name-goes-here"></span>!</h1>
        <p>Before you start using this application, we need to know a few more things about you:</p>
        <br>
        <form id="studentchecker" style="display:block">
            <h4>Are you a BCIT student?</h4>
            <!--             <input type="radio" id="is_student" name="stu1" value="true">
            <label for="is_student" style="margin-right:20pt">Yes</label>
            <input type="radio" id="not_student" name="stu1" value="false">
            <label for="not_student">No</label><br> -->
            <button type="button" id="is_student" style="margin-right:40pt;margin-top:10pt;">Yes</button>
            <button type="button" id="not_student">No</button>
        </form>
        <div id="form-here"></div>

        <button type="button" id="backbutton" style="text-align:left;display:none;margin-left:25%;">Back</button>
        <!-------------------------------------------------------->
        <!-------------------------STUDENT FORM------------------->
        <div id="student-form" style="display:none">
            <form style="margin-top: 0pt;">
                <h4>For students</h4>
                <label for="student_number">What is your student number? </label> <br>
                A<input id="student_number" type="number" name="student_number" required><br><br>
                Are you vaccinated? <br>
                <input type="radio" id="is_vax" name="vax" value="true" required>
                <label for="is_vax" style="margin-right:20pt">Yes</label>
                <input type="radio" id="not_vax" name="vax" value="false" required>
                <label for="not_vax">No</label><br><br>
                <!-- <input id="student-submit" type="submit" value="Submit"> -->
                <button type="button" onclick="studentSubmit()">Submit</button>
            </form>
        </div>

        <!-------------------------------------------------------->
        <!-------------------------PUBLIC FORM------------------->
        <div id="public-form" style="display:none">
            <form style="margin-top: 0pt;" action="main.html">
                <h4>For the general public</h4>
                <label for="phoneNumber1">What is your phone number? </label> <br>
                <input id="phoneNumber1" type="number" name="phoneNumber1" required><br><br>

                Are you vaccinated? <br>
                <input type="radio" id="is_vax2" name="vax1" value="true" required>
                <label for="is_vax2" style="margin-right:20pt">Yes</label>
                <input type="radio" id="not_vax2" name="vax1" value="false" required>
                <label for="not_vax2">No</label><br><br>
                <!-- <input id="public-submit" type="button" value="Submit"> -->
                <button type="button" onclick="publicSubmit()">Submit</button>
            </form>
        </div>
    </section>

    <!---------JS STUFF--------->
    <script>


        //Printing name for DB to check if its connected
        function insertName() {
            firebase.auth().onAuthStateChanged(user => {
                // Check if user is signed in:
                if (user) {
                    // Do something for the current logged-in user here: 
                    //console.log(user.uid);
                    //go to the correct user document by referencing to the user uid
                    currentUser = db.collection("users").doc(user.uid);
                    //get the document for current user.
                    currentUser.get()
                        .then(userDoc => {
                            var user_Name = userDoc.data().name;
                            //console.log(user_Name);
                            //method #1:  insert with html only
                            //document.getElementById("name-goes-here").innerText = n;    //using javascript
                            //method #2:  insert using jquery
                            $("#name-goes-here").text(user_Name);                         //using jquery
                        })
                } else {
                    document.getElementById("name-goes-here").innerText = "friend!";
                    // No user is signed in.
                }
            });
        }
        insertName();


        document.querySelector("#is_student").addEventListener("click", function (e) {
            e.preventDefault();
            let studentForm = document.getElementById("student-form");
            studentForm.style.display = "block";
            let formDiv = document.getElementById("public-form");
            formDiv.style.display = "none";
            let studentCheck = document.getElementById("studentchecker");
            studentCheck.style.display = "none";
            let b_button = document.getElementById("backbutton");
            b_button.style.display = "block";
        });

        document.querySelector("#not_student").addEventListener("click", function (e) {
            e.preventDefault();
            let studentForm = document.getElementById("student-form");
            studentForm.style.display = "none";
            let formDiv = document.getElementById("public-form");
            formDiv.style.display = "block";
            let studentCheck = document.getElementById("studentchecker");
            studentCheck.style.display = "none";
            let b_button = document.getElementById("backbutton");
            b_button.style.display = "block";
        });

        document.querySelector("#backbutton").addEventListener("click", function (e) {
            e.preventDefault();
            let studentForm = document.getElementById("student-form");
            studentForm.style.display = "none";
            let formDiv = document.getElementById("public-form");
            formDiv.style.display = "none";
            let studentCheck = document.getElementById("studentchecker");
            studentCheck.style.display = "block";
            let b_button = document.getElementById("backbutton");
            b_button.style.display = "none";
        });


        function studentSubmit() {
            console.log("Hello!");
            let stuNum = document.getElementById("student_number").value;
            let vaxStat = document.getElementsByName("vax");
            let vaxx = "";
            for (i = 0; i < vaxStat.length; i++) {
                if (vaxStat[0].checked) {
                    vaxx = true;
                }

            }
            let isStudent = true;



            firebase.auth().onAuthStateChanged(user => {
                // Check if user is signed in:
                if (user) {
                    db.collection("users").doc(user.uid).update({
                        studentNumber: stuNum,
                        vaxStatus: vaxx,
                        studentStatus: isStudent
                    }).then(function () {
                        window.location.assign("main.html");
                    })
                        .catch(function (error) {
                            console.log("Error adding new user: " + error);
                        });
                } else {
                    // No user is signed in.
                }
            });

            /* window.location.assign("main.html"); */
        }


        function publicSubmit() {
            console.log("Hello!");
            let phoneNum = document.getElementById("phoneNumber1").value;
            let vaxStat = document.getElementsByName("vax1");
            let vaxx = "";
            for (i = 0; i < vaxStat.length; i++) {
                if (vaxStat[0].checked) {
                    vaxx = true;
                } else {
                    vaxx = false;
                }

            }
            let isStudent = false;


            firebase.auth().onAuthStateChanged(user => {
                // Check if user is signed in:
                if (user) {
                    db.collection("users").doc(user.uid).update({
                        phoneNumber: phoneNum,
                        vaxStatus: vaxx,
                        studentStatus: isStudent
                    }).then(function () {
                        window.location.assign("main.html");
                    })
                        .catch(function (error) {
                            console.log("Error adding new user: " + error);
                        });
                } else {
                    // No user is signed in.
                }
            });

            /* window.location.assign("main.html"); */
        }
    </script>
</body>

</html>